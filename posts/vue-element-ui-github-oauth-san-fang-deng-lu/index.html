<!DOCTYPE html>
<html lang="zh">

<head>
<meta charset="utf-8" />
<meta name="author" content="pocoyo" />
<meta name="description" content="Personal blog." />
<meta name="keywords" content="blog, tech" />
<meta name="google-site-verification" content="k8WIOcecDRQPeZ2x500693x2f2W85xDEm87gV1_lWl0" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.62.2" />

<link rel="canonical" href="https://emacle.github.io/posts/vue-element-ui-github-oauth-san-fang-deng-lu/">
<link rel="icon" href="https://emacle.github.io/favicon.ico">
<meta property="og:title" content="Vue Element-ui Github oAuth 三方登录" />
<meta property="og:description" content="Github 网站创建 OAuth Apps 记录 Client ID / Client Secret / Authorization Callback URL 3个参数 此处 Authorization Callback URL 为默认回调网址，程序代码里没有明确指定的话，以此为默认值，代码里指定的话 指定的redirect 一定要与此处一致防止提交时校验出错 ip/域名都可，在弹出子窗口进行授权确定时，三方服务器会校验 url里的redirect参数(程序里指定的)与创建三方应用里指定的 callback 地址，如果不一致会出错
http://host:port/auth-redirect # 必须与创建应用时填入值一致http://localhost:9527/auth-redirecthttp://172.17.1.110:10000/auth-redirecthttp://www.vueauth.org:10000/auth-redirect # 浏览器的主机 hosts/dns 里需要解析 www.vueauth.org    socialsignin.vue 三方登录模块里，构造弹出窗口 github 认证 url
githubHandleClick(thirdpart) {// 1. 指定授权 client_id 及 redirect_uri 的 URL // 如果不指定 redirect_uri, 则默认使用 gihtub =&gt; Settings =&gt; Developer settings =&gt; OAuth Apps 里 Authorization callback URL 配置的地址 // 为了无歧义尽量在程序代码里指定redirect_uri // const url = &#39;https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://emacle.github.io/posts/vue-element-ui-github-oauth-san-fang-deng-lu/" />
<meta property="article:published_time" content="2020-03-06T11:42:00+08:00" />
<meta property="article:modified_time" content="2020-03-06T11:42:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vue Element-ui Github oAuth 三方登录"/>
<meta name="twitter:description" content="Github 网站创建 OAuth Apps 记录 Client ID / Client Secret / Authorization Callback URL 3个参数 此处 Authorization Callback URL 为默认回调网址，程序代码里没有明确指定的话，以此为默认值，代码里指定的话 指定的redirect 一定要与此处一致防止提交时校验出错 ip/域名都可，在弹出子窗口进行授权确定时，三方服务器会校验 url里的redirect参数(程序里指定的)与创建三方应用里指定的 callback 地址，如果不一致会出错
http://host:port/auth-redirect # 必须与创建应用时填入值一致http://localhost:9527/auth-redirecthttp://172.17.1.110:10000/auth-redirecthttp://www.vueauth.org:10000/auth-redirect # 浏览器的主机 hosts/dns 里需要解析 www.vueauth.org    socialsignin.vue 三方登录模块里，构造弹出窗口 github 认证 url
githubHandleClick(thirdpart) {// 1. 指定授权 client_id 及 redirect_uri 的 URL // 如果不指定 redirect_uri, 则默认使用 gihtub =&gt; Settings =&gt; Developer settings =&gt; OAuth Apps 里 Authorization callback URL 配置的地址 // 为了无歧义尽量在程序代码里指定redirect_uri // const url = &#39;https://github."/>


<meta itemprop="name" content="Vue Element-ui Github oAuth 三方登录">
<meta itemprop="description" content="Github 网站创建 OAuth Apps 记录 Client ID / Client Secret / Authorization Callback URL 3个参数 此处 Authorization Callback URL 为默认回调网址，程序代码里没有明确指定的话，以此为默认值，代码里指定的话 指定的redirect 一定要与此处一致防止提交时校验出错 ip/域名都可，在弹出子窗口进行授权确定时，三方服务器会校验 url里的redirect参数(程序里指定的)与创建三方应用里指定的 callback 地址，如果不一致会出错
http://host:port/auth-redirect # 必须与创建应用时填入值一致http://localhost:9527/auth-redirecthttp://172.17.1.110:10000/auth-redirecthttp://www.vueauth.org:10000/auth-redirect # 浏览器的主机 hosts/dns 里需要解析 www.vueauth.org    socialsignin.vue 三方登录模块里，构造弹出窗口 github 认证 url
githubHandleClick(thirdpart) {// 1. 指定授权 client_id 及 redirect_uri 的 URL // 如果不指定 redirect_uri, 则默认使用 gihtub =&gt; Settings =&gt; Developer settings =&gt; OAuth Apps 里 Authorization callback URL 配置的地址 // 为了无歧义尽量在程序代码里指定redirect_uri // const url = &#39;https://github.">
<meta itemprop="datePublished" content="2020-03-06T11:42:00&#43;08:00" />
<meta itemprop="dateModified" content="2020-03-06T11:42:00&#43;08:00" />
<meta itemprop="wordCount" content="696">



<meta itemprop="keywords" content="vue,element,github,oauth," />

<link rel="stylesheet" href="/css/layout.css" />


<link rel="stylesheet" href="/css/default-dark.css" />




<title>


     Vue Element-ui Github oAuth 三方登录 

</title>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="https://emacle.github.io/">~振鹭于飞~</a>
    </div> 

    
    
    <a class="nav-item" href="/posts/"><div class="nav-item-title">Posts</div></a>
    
    <a class="nav-item" href="/tags/"><div class="nav-item-title">Tags</div></a>
    

  </nav>

  
<div class="social-links-header">

  

  
  <a href="https://github.com/emacle" target="_blank"><div class="social-link">gh</div></a>
  

  

  

  

</div>


</div>


</header>


<article class="post">
    <h1 class="title"> Vue Element-ui Github oAuth 三方登录 </h1>
    <div class="content"> <figure><a href="/ox-hugo/github_login.gif">
    <img src="/ox-hugo/github_login.gif"/> </a>
</figure>

<ol>
<li>
<p>Github 网站创建 OAuth Apps 记录 <code>Client ID</code> / <code>Client Secret</code> / <code>Authorization Callback URL</code> 3个参数
此处 <code>Authorization Callback URL</code> 为默认回调网址，程序代码里没有明确指定的话，以此为默认值，代码里指定的话
指定的redirect <code>一定要与此处一致防止提交时校验出错</code> ip/域名都可，在弹出子窗口进行授权确定时，三方服务器会校验
url里的redirect参数(程序里指定的)与创建三方应用里指定的 callback 地址，如果不一致会出错</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">http://host:port/auth-redirect <span style="color:#776e71"># 必须与创建应用时填入值一致</span>
http://localhost:9527/auth-redirect
http://172.17.1.110:10000/auth-redirect
http://www.vueauth.org:10000/auth-redirect  <span style="color:#776e71"># 浏览器的主机 hosts/dns 里需要解析 www.vueauth.org</span>
</code></pre></div><figure><a href="/ox-hugo/github-oauth.png">
    <img src="/ox-hugo/github-oauth.png"/> </a>
</figure>

</li>
<li>
<p>socialsignin.vue 三方登录模块里，构造弹出窗口 github 认证 url</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#06b6ef">githubHandleClick</span>(<span style="color:#06b6ef">thirdpart</span>) {
    <span style="color:#776e71">// 1. 指定授权 client_id 及 redirect_uri 的 URL
</span><span style="color:#776e71"></span>    <span style="color:#776e71">//    如果不指定 redirect_uri, 则默认使用 gihtub =&gt; Settings =&gt; Developer settings =&gt;  OAuth Apps 里 Authorization callback URL 配置的地址
</span><span style="color:#776e71"></span>    <span style="color:#776e71">//    为了无歧义尽量在程序代码里指定redirect_uri
</span><span style="color:#776e71"></span>    <span style="color:#776e71">// const url = &#39;https://github.com/login/oauth/authorize?client_id=94aae05609c96ffb7d3b&amp;redirect_uri=http://localhost:9527/auth-redirect&#39;
</span><span style="color:#776e71"></span>    <span style="color:#06b6ef">githubAuth</span>().<span style="color:#06b6ef">then</span>(<span style="color:#06b6ef">response</span> =&gt; { <span style="color:#776e71">// githubAuth() 参数 code 为空，由后端返回 authorize_url
</span><span style="color:#776e71"></span>   <span style="color:#776e71">// 2. 弹出子窗口进行授权, 子窗口完成授权后, 子窗口地址栏URL 会是 redirect_uri 并带上 ?code= 参数与&amp;state= 参数
</span><span style="color:#776e71"></span>   <span style="color:#776e71">//    子窗口单击确定按钮授权时，会校验此时的redirect 与 创建三方应用时填写的 callback 不一致会出错
</span><span style="color:#776e71"></span>   <span style="color:#815ba4">const</span> <span style="color:#06b6ef">url</span> <span style="color:#5bc4bf">=</span> <span style="color:#06b6ef">response</span>.<span style="color:#06b6ef">data</span>.<span style="color:#06b6ef">auth_url</span>
   <span style="color:#776e71">// console.log(&#39;auth url....&#39;, url)
</span><span style="color:#776e71"></span>   <span style="color:#776e71">// =&gt;  https://github.com/login/oauth/authorize?state=137caabc2b409f0cccd14834fc848041&amp;response_type=code&amp;approval_prompt=auto&amp;redirect_uri=http://localhost:9527/auth-redirect&amp;client_id=94aae05609c96ffb7d3b
</span><span style="color:#776e71"></span>   <span style="color:#06b6ef">openWindow</span>(<span style="color:#06b6ef">url</span>, <span style="color:#06b6ef">thirdpart</span>, <span style="color:#f99b15">540</span>, <span style="color:#f99b15">540</span>)
    }).<span style="color:#815ba4">catch</span>(<span style="color:#06b6ef">error</span> =&gt; {
   <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#06b6ef">error</span>)
    })
}
</code></pre></div></li>
<li>
<p>authredirect.vue 里，即第2步url参数 redirect_uri 指定的回调地址对应的路由组件(/auth-redirect)，在此弹出的子窗口里进行授权，授权完成后，调用js 的 window.opener 方法 给 父窗口 的 location.href 赋值，父窗口地址栏变为 会带有 github 返回的 ?code 参数，同时关闭子窗口，代码逻辑转至父窗口进行后续处理</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#06b6ef">name</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;AuthRedirect&#39;</span>,
<span style="color:#06b6ef">created</span>() {
  <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">githubLogin</span>()
},
<span style="color:#06b6ef">methods</span><span style="color:#5bc4bf">:</span> {
      <span style="color:#06b6ef">githubLogin</span>() {
      <span style="color:#776e71">// 1.  授权成功后, github 返回给 AuthRedirect子窗口的浏览器 回调地址 并带上 ?code=8789d613d1fa9a19732a&amp;state=xyz 参数
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//     地址栏URL如 http://localhost:9527/auth-redirect?code=8789d613d1fa9a19732a&amp;state=xyz
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//     其中 http://localhost:9527/auth-redirect 是定义 githubHandleClick() 里定义或服务端返回的回调地址
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//     const url = &#39;https://github.com/login/oauth/authorize?client_id=94aae05609c96ffb7d3b&amp;redirect_uri=http://localhost:9527/auth-redirect&#39;
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//     此时 window.location.href   =&gt; http://localhost:9527/auth-redirect?code=8789d613d1fa9a19732a&amp;state=137caabc2b409f0cccd14834fc848041
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//         window.location.search  =&gt; ?code=8789d613d1fa9a19732a&amp;state=137caabc2b409f0cccd14834fc848041
</span><span style="color:#776e71"></span>
      <span style="color:#776e71">// 2. 调用 window.opener 方法 给 父窗口 的 location.href 赋值 =&gt; http://localhost:9527/login?code=8789d613d1fa9a19732a
</span><span style="color:#776e71"></span>      window.<span style="color:#06b6ef">opener</span>.<span style="color:#06b6ef">location</span>.<span style="color:#06b6ef">href</span> <span style="color:#5bc4bf">=</span> window.<span style="color:#06b6ef">location</span>.<span style="color:#06b6ef">origin</span> <span style="color:#5bc4bf">+</span> <span style="color:#48b685">&#39;/login&#39;</span> <span style="color:#5bc4bf">+</span> window.<span style="color:#06b6ef">location</span>.<span style="color:#06b6ef">search</span>
      <span style="color:#776e71">//    注意：此处加入 /login 是因为 router /login 在 permission.js的whiteLis里不会发生重定向而导致href里丢失?code等参数,从而
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//         可以在login/index.vue里直接通过location或vue route 获取code，state参数，不必在permission.js里获取并保存至store里
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//         ***非常关键***，不加的话默认/ 是等价于/dashboard不在白名单里路由根据permission.js逻辑会发生重定向至/login里此时会丢失?code等参数
</span><span style="color:#776e71"></span>      <span style="color:#776e71">//    可在此 使用未定义的变量 来 debug  // Error in created hook: &#34;ReferenceError: hash is not defined&#34; found in window.opener.location.href = window.location.origin + &#39;?&#39; + hash
</span><span style="color:#776e71"></span>      <span style="color:#776e71">// 3. 关闭 AuthRedirect 子窗口。同时代码逻辑至父窗口 在 permission.js =&gt; router.beforeEach 进行 code 处理
</span><span style="color:#776e71"></span>      window.<span style="color:#06b6ef">close</span>()
    }
}
</code></pre></div></li>
<li>
<p>login/index.vue 代码逻辑转至此处， created 生命周期里，判断 如果存在则为github三方登录,前端调用githubAuth 函数带code参数向后台进行认证正确后会返回给前面 token/refresh_token，前面配置token正确后却可正常登录 (与后端交互时可加入三方登录loading动画效果提示)</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#06b6ef">created</span>() {
    <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">githubLogin</span>()
},
<span style="color:#06b6ef">methods</span><span style="color:#5bc4bf">:</span> {
    <span style="color:#06b6ef">githubLogin</span>() {
   <span style="color:#776e71">// console.log(&#39;in login/index.vue....&#39;, window.location, this.$route, this.$router)
</span><span style="color:#776e71"></span>   <span style="color:#776e71">// 获取三方登录 code
</span><span style="color:#776e71"></span>   <span style="color:#776e71">// 更可靠稳定的获取code方法 使用 vue router to 对象来获取
</span><span style="color:#776e71"></span>   <span style="color:#776e71">// 如果路由存在code 与 state 参数，如http://localhost:9527/login?code=8789d613d1fa9a19732a&amp;state=xyz
</span><span style="color:#776e71"></span>   <span style="color:#815ba4">if</span> (<span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$route</span>.<span style="color:#06b6ef">query</span>.<span style="color:#06b6ef">hasOwnProperty</span>(<span style="color:#48b685">&#39;code&#39;</span>) <span style="color:#5bc4bf">&amp;&amp;</span> <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$route</span>.<span style="color:#06b6ef">query</span>.<span style="color:#06b6ef">hasOwnProperty</span>(<span style="color:#48b685">&#39;state&#39;</span>)) { <span style="color:#776e71">// this.$route.query 如果存在 code 则为三方登录则写入store 变量
</span><span style="color:#776e71"></span>       <span style="color:#815ba4">const</span> <span style="color:#06b6ef">code</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$route</span>.<span style="color:#06b6ef">query</span>.<span style="color:#06b6ef">code</span>
       <span style="color:#815ba4">const</span> <span style="color:#06b6ef">state</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$route</span>.<span style="color:#06b6ef">query</span>.<span style="color:#06b6ef">state</span>
       <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#48b685">&#39;github code: &#39;</span>, <span style="color:#06b6ef">code</span>)
       <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#48b685">&#39;github state: &#39;</span>, <span style="color:#06b6ef">state</span>)
       <span style="color:#776e71">// store.state.user.code = code
</span><span style="color:#776e71"></span>       <span style="color:#776e71">// store.state.user.code_state = state
</span><span style="color:#776e71"></span>       <span style="color:#776e71">// console.log(store.state.user) // 该code 在store/modules/user.js 里定义有 作为第三方登录使用 参见其中 LoginByThirdparty
</span><span style="color:#776e71"></span>
       <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">thirdLogin</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">true</span>
       <span style="color:#815ba4">const</span> <span style="color:#06b6ef">loading</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$loading</span>({
           <span style="color:#06b6ef">lock</span><span style="color:#5bc4bf">:</span> <span style="color:#815ba4">true</span>,
           <span style="color:#06b6ef">text</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;github 认证登录中...&#39;</span>,
           <span style="color:#06b6ef">spinner</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;el-icon-loading&#39;</span>,
           <span style="color:#06b6ef">background</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;rgba(0, 0, 0, 0.7)&#39;</span>
       })

       <span style="color:#815ba4">const</span> <span style="color:#06b6ef">authParms</span> <span style="color:#5bc4bf">=</span> { <span style="color:#06b6ef">code</span>, <span style="color:#06b6ef">state</span> }
       <span style="color:#776e71">// 执行 GET githubAuth 根据 code 获取 github userinfo 结合业务逻辑生成 token / refreshtoken (jwt)
</span><span style="color:#776e71"></span>       <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$store</span>.<span style="color:#06b6ef">dispatch</span>(<span style="color:#48b685">&#39;githubAuth&#39;</span>, <span style="color:#06b6ef">authParms</span>).<span style="color:#06b6ef">then</span>(() =&gt; {
           <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">$router</span>.<span style="color:#06b6ef">push</span>({ <span style="color:#06b6ef">path</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;/&#39;</span> })
           <span style="color:#06b6ef">loading</span>.<span style="color:#06b6ef">close</span>()
       }).<span style="color:#815ba4">catch</span>((<span style="color:#06b6ef">err</span>) =&gt; {
           <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#48b685">&#39;this.$store.dispatchgithubAuth catch....&#39;</span>, <span style="color:#06b6ef">err</span>.<span style="color:#06b6ef">response</span>)
           <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">thirdLogin</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">false</span>
           <span style="color:#06b6ef">loading</span>.<span style="color:#06b6ef">close</span>()
       }).<span style="color:#815ba4">finally</span>((<span style="color:#06b6ef">e</span>) =&gt; {
           <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#48b685">&#39;this.$store.dispatchgithubAuth finally....&#39;</span>, <span style="color:#06b6ef">e</span>)
           <span style="color:#815ba4">this</span>.<span style="color:#06b6ef">thirdLogin</span> <span style="color:#5bc4bf">=</span> <span style="color:#815ba4">false</span>
           <span style="color:#06b6ef">loading</span>.<span style="color:#06b6ef">close</span>()
       })
   }
    }
}
</code></pre></div><div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#776e71">// github认证
</span><span style="color:#776e71"></span><span style="color:#06b6ef">githubAuth</span>({ <span style="color:#06b6ef">commit</span> }, <span style="color:#06b6ef">authParms</span>) {
    <span style="color:#815ba4">return</span> <span style="color:#815ba4">new</span> Promise((<span style="color:#06b6ef">resolve</span>, <span style="color:#06b6ef">reject</span>) =&gt; {
   <span style="color:#06b6ef">githubAuth</span>(<span style="color:#06b6ef">authParms</span>.<span style="color:#06b6ef">code</span>, <span style="color:#06b6ef">authParms</span>.<span style="color:#06b6ef">state</span>).<span style="color:#06b6ef">then</span>(<span style="color:#06b6ef">response</span> =&gt; {
       <span style="color:#06b6ef">console</span>.<span style="color:#06b6ef">log</span>(<span style="color:#48b685">&#39;githubAuth response...&#39;</span>, <span style="color:#06b6ef">response</span>)
       <span style="color:#815ba4">const</span> <span style="color:#06b6ef">data</span> <span style="color:#5bc4bf">=</span> <span style="color:#06b6ef">response</span>.<span style="color:#06b6ef">data</span>
       <span style="color:#06b6ef">commit</span>(<span style="color:#48b685">&#39;SET_TOKEN&#39;</span>, <span style="color:#06b6ef">data</span>.<span style="color:#06b6ef">token</span>)
       <span style="color:#06b6ef">commit</span>(<span style="color:#48b685">&#39;SET_REFRESH_TOKEN&#39;</span>, <span style="color:#06b6ef">data</span>.<span style="color:#06b6ef">refresh_token</span>)
       <span style="color:#06b6ef">setToken</span>(<span style="color:#06b6ef">data</span>.<span style="color:#06b6ef">token</span>)
       <span style="color:#06b6ef">setRefreshToken</span>(<span style="color:#06b6ef">data</span>.<span style="color:#06b6ef">refresh_token</span>)
       <span style="color:#06b6ef">resolve</span>()
   }).<span style="color:#815ba4">catch</span>(<span style="color:#06b6ef">error</span> =&gt; {
       <span style="color:#06b6ef">reject</span>(<span style="color:#06b6ef">error</span>)
   })
    })
},

<span style="color:#776e71">// github 认证api
</span><span style="color:#776e71"></span><span style="color:#815ba4">export</span> <span style="color:#815ba4">function</span> <span style="color:#06b6ef">githubAuth</span>(<span style="color:#06b6ef">code</span>) {
    <span style="color:#815ba4">return</span> <span style="color:#06b6ef">request</span>({
   <span style="color:#06b6ef">url</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;/sys/user/githubauth&#39;</span>,
   <span style="color:#06b6ef">method</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;get&#39;</span>,
   <span style="color:#06b6ef">params</span><span style="color:#5bc4bf">:</span> { <span style="color:#06b6ef">code</span> }
    })
}
</code></pre></div></li>
<li>
<p>后端php /sys/user/githubauth 接口, 引用 <code>league/oauth2-client</code> 包生成 <code>授权链接</code>  根据code与github进行交互，主要有获取github <code>access_token</code> 与 获取github <code>userinfo</code>
后端也可以自动封装函数来获取github交互信息 (如果是php可利用composer安装一些三方登录插件错误校验比较完善，一般需要php开启 开启php.ini中的session.auto_start配置 使用session，
测试 league/oauth2-client 包没有开启 php session <code>也可以使用 $_SESSION['oauth2state']</code> 变量，也可以 <code>redis</code> 替换)</p>
<p><a href="https://oauth2-client.thephpleague.com/providers/league/">https://oauth2-client.thephpleague.com/providers/league/</a> 可在此网站查找部分官方包及第三方封装的 leageue php 登录包</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#776e71"># league/oauth2-client 是通用客户端 github,gitee ok!!!</span>
<span style="color:#776e71"># In most cases, you&#39;ll want to use a specific provider client library rather than this base library.</span>
composer require league/oauth2-github  <span style="color:#776e71"># github ok!!!</span>
composer require spoonwep/oauth2-qq    <span style="color:#776e71"># QQ OAuth 2.0 support for the PHP League&#39;s OAuth 2.0 Client</span>
composer require oakhope/oauth2-wechat <span style="color:#776e71"># 未测试</span>
</code></pre></div><p>oauth2-client 包官方 demo 捕获异常时 指定IdentityProviderException 不能捕获其依赖包 guzzlehttp 里的错误异常 使用 Exception $e 替换</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">GuzzleHttp\Exception\ConnectException  Message: cURL error 35: OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to api.github.com:443
</code></pre></div><div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#776e71">&lt;?php</span>
<span style="color:#815ba4">try</span>{
    <span style="color:#776e71"># getaccessToken...
</span><span style="color:#776e71"></span>    <span style="color:#776e71"># get userinfo...
</span><span style="color:#776e71"></span>    <span style="color:#776e71">//} catch (\League\OAuth2\Client\Provider\Exception\IdentityProviderException $e) {
</span><span style="color:#776e71"></span>} <span style="color:#815ba4">catch</span> (<span style="color:#06b6ef">Exception</span> <span style="color:#ef6155">$e</span>) {
    <span style="color:#776e71">// Failed to get the access token or user details.
</span><span style="color:#776e71"></span>    <span style="color:#815ba4">exit</span>(<span style="color:#ef6155">$e</span><span style="color:#5bc4bf">-&gt;</span><span style="color:#06b6ef">getMessage</span>());
}
</code></pre></div></li>
<li>
<p>vue路由模式最好使用history, hash模式的话url中的#字符认证中转时不太好处理，history模式在 <code>生产环境</code> 中需要配置后端服务器支持(此后端为vue编译生成的静态网页面代码部署的服务器，如 <a href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/essentials/deploy.html#%25E5%258F%2591%25E5%25B8%2583">apache route history mode配置参考</a> ， <code>并不是后端接口的服务器</code> )</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#ef6155">@</span><span style="color:#06b6ef">router</span><span style="color:#5bc4bf">/</span><span style="color:#06b6ef">index</span>.<span style="color:#06b6ef">js</span>
<span style="color:#815ba4">export</span> <span style="color:#815ba4">default</span> <span style="color:#815ba4">new</span> <span style="color:#06b6ef">Router</span>({
<span style="color:#06b6ef">mode</span><span style="color:#5bc4bf">:</span> <span style="color:#48b685">&#39;history&#39;</span>, <span style="color:#776e71">// require service support 前端部署的时候 apache 需要配置文件 .htaccess
</span><span style="color:#776e71"></span><span style="color:#06b6ef">scrollBehavior</span><span style="color:#5bc4bf">:</span> () =&gt; ({ <span style="color:#06b6ef">y</span><span style="color:#5bc4bf">:</span> <span style="color:#f99b15">0</span> }),
<span style="color:#06b6ef">routes</span><span style="color:#5bc4bf">:</span> <span style="color:#06b6ef">constantRouterMap</span>
})
</code></pre></div></li>
<li>
<p>完整代码 <a href="https://github.com/emacle/vue-php-admin">https://github.com/emacle/vue-php-admin</a></p>
</li>
<li>
<p>其它问题</p>
<ul>
<li>
<p>cURL error 60: SSL certificate problem: unable to get local issuer certifica 解决
从 <a href="https://curl.haxx.se/docs/caextract.html">https://curl.haxx.se/docs/caextract.html</a> 上下载cacert.pem</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"># vi php.ini  搜索curl.cainfo 与 openssl.cafile,将其配置成你自己cacert.pem文件的路径
curl.cainfo=&#34;D:\phpstudy_pro\Extensions\php\php7.3.4nts\extras\ssl\cacert.pem&#34;
openssl.cafile=&#34;D:\phpstudy_pro\Extensions\php\php7.3.4nts\extras\ssl\cacert.pem&#34;
</code></pre></div></li>
<li>
<p><a href="https://blog.yorkxin.org/2013/09/30/oauth2-4-1-auth-code-grant-flow.html">OAuth 2.0 筆記 (4.1) Authorization Code Grant Flow 細節</a></p>
</li>
<li>
<p>github 登录报错 回调地址不一致出错提示 github与gitee 不太一样</p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">github 在地址栏提示
</code></pre></div><p><a href="http://localhost:9527/auth-redirect?error=redirect%5Furi%5Fmismatch&amp;error%5Fdescription=The">http://localhost:9527/auth-redirect?error=redirect%5Furi%5Fmismatch&amp;error%5Fdescription=The</a> redirect_uri MUST match the registered callback URL for this application.&amp; error_uri=<a href="https://developer.github.com/apps/managing-oauth-apps/troubleshooting-authorization-request-errors/#redirect-uri-mismatch%23/auth-redirect">https://developer.github.com/apps/managing-oauth-apps/troubleshooting-authorization-request-errors/#redirect-uri-mismatch%23/auth-redirect</a></p>
<div class="highlight"><pre style="color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">gitee 提示子窗口显示 回调地址有误
</code></pre></div></li>
</ul>
</li>
</ol>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
            
<div class="tags">
  
    
      <div class="tag">
        <a href="/tags/vue">#vue</a>
      </div>
    
      <div class="tag">
        <a href="/tags/element">#element</a>
      </div>
    
      <div class="tag">
        <a href="/tags/github">#github</a>
      </div>
    
      <div class="tag">
        <a href="/tags/oauth">#oauth</a>
      </div>
    
  
</div>

	    
	    
	    <div class="date"> Fri, 06 Mar 2020 11:42:00 CST </div>

    
  </div>
</footer>
    
    
    
    

  
  

<script src="https://utteranc.es/client.js"
        repo="emacle/utterances"
        issue-term="pathname"
        theme="github-dark"
	label="hugo"
        crossorigin="anonymous"
        async>
</script>




</article>

  <footer>

  <div class="social-links-footer">

  

  
  <a href="https://github.com/emacle" target="_blank"><div class="social-link">GitHub</div></a>
  

  <span id="busuanzi_container_site_uv" style="display:none">
    <span id="busuanzi_value_site_uv"></span>
  </span>

  

  

  

  <div class="social-link">
  <a href="https://emacle.github.io/index.xml" target="_blank">RSS</a>
  </div>
  <span id="busuanzi_container_site_pv" style="display:none">
    <span id="busuanzi_value_site_pv"></span> | <span id="busuanzi_value_page_pv"></span>
  </span>

</div>


  <div class="copyright">  </div>

  
  
  

  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</div> 

</body>
</html>

